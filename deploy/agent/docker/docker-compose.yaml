services:
  agent-ingest:
    image: sammascanner/wazuh-agent:regular_0.2
    volumes:
      # ============================================================
      # HOST MONITORING MOUNTS (Read-Only for Security)
      # ============================================================
      # These mounts allow the Wazuh agent to monitor the host system.
      # All mounts are READ-ONLY (:ro) to prevent container from modifying host.
      # ============================================================
      
      # Host /etc - Required for monitoring system configuration files
      # Read-only: Agent only needs to read configs for integrity monitoring
      - /etc:/hostfs/etc:ro
      
      # Host /var/log - Required for log collection and analysis
      # Read-only: Agent only needs to read logs, not write to them
      - /var/log:/hostfs/var/log:ro
      
      # ============================================================
      # NAMED VOLUMES (Isolated from Host)
      # ============================================================
      # Named volume for Wazuh agent configuration
      - agent-ossec-etc:/var/ossec/etc
      # Named volume for Wazuh agent data
      - agent-ossec-data:/var/ossec/data
      # Named volume for Wazuh agent logs
      - agent-ossec-logs:/var/ossec/logs
      
      # ============================================================
      # REMOVED MOUNTS (Security Hardening)
      # ============================================================
      # The following mounts were removed as they pose security risks:
      # - /usr/local/bin:/hostfs/usr/local/bin (host binaries - not needed)
      # - /var/run:/hostfs/var/run (runtime sockets - security risk)
      # - /bin:/hostfs/bin (system binaries - security risk)
      # - /boot:/hostfs/boot (boot partition - critical security risk)
      # - /dev:/hostfs/dev (device files - critical security risk)
      # - /lib:/hostfs/lib (system libraries - security risk)
      # ============================================================
    environment:
      - "MANAGER_URL=${MANAGER_URL:?MANAGER_URL is required}"
      - "MANAGER_PORT=${MANAGER_PORT:?MANAGER_PORT is required}"
      - "SERVER_URL=${SERVER_URL:?SERVER_URL is required}"
      - "SERVER_PORT=${SERVER_PORT:?SERVER_PORT is required}"
      - "NAME=${NAME:?NAME is required}"
      - "GROUP=${GROUP:?GROUP is required}"
      - "ENROL_TOKEN=${ENROL_TOKEN:?ENROL_TOKEN is required}"

volumes:
  # Named volumes for Wazuh agent (isolated from host filesystem)
  agent-ossec-etc:
    driver: local
  agent-ossec-data:
    driver: local
  agent-ossec-logs:
    driver: local
