# =============================================================================
# Fail2ban Filter: Rate Limit Violations (429)
# =============================================================================
# Detects clients that are hitting rate limits repeatedly
# Matches Nginx JSON log format (security_json from logging.conf)
#
# JSON log example:
# {"timestamp":"2026-01-29T10:00:00Z","remote_addr":"192.168.1.100",
#  "request_method":"GET","request_uri":"/api/health","status":429,...}
# =============================================================================

[Definition]

# Match 429 Too Many Requests responses
failregex = ^.*"remote_addr":"<HOST>".*"status":\s*429\b.*$

# Ignore legitimate cases (if any)
ignoreregex =

# Date pattern for ISO 8601 timestamps in JSON logs
datepattern = "timestamp":"%%Y-%%m-%%dT%%H:%%M:%%S