# =============================================================================
# Fail2ban Filter: Authentication Failures (401/403)
# =============================================================================
# Detects failed authentication attempts against the Wazuh API
# Matches Nginx JSON log format (security_json from logging.conf)
#
# JSON log example:
# {"timestamp":"2026-01-29T10:00:00Z","remote_addr":"192.168.1.100",
#  "request_method":"POST","request_uri":"/ingest","status":401,...}
# =============================================================================

[Definition]

# Match 401 Unauthorized or 403 Forbidden responses
# The regex extracts the IP from the "remote_addr" field in JSON logs
failregex = ^.*"remote_addr":"<HOST>".*"status":\s*(401|403)\b.*$

# Ignore legitimate cases (if any)
ignoreregex =

# Date pattern for ISO 8601 timestamps in JSON logs
# Example: "timestamp":"2026-01-29T10:00:00Z"
datepattern = "timestamp":"%%Y-%%m-%%dT%%H:%%M:%%S